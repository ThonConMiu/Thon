-- ============================================
-- CHEST FARM SCRIPT - BLOX FRUITS (OPTIMIZED)
-- ============================================
_G.AutoFarmChest = false
_G.ChestBypass = false
_G.StopChest = true
_G.MagnitudeAdd = 0
AutoFarmChest = false
ChestESP = false
Number = math.random(1, 1000000)
local LP = game.Players.LocalPlayer
local RS = game:GetService("ReplicatedStorage")
local WS = game:GetService("Workspace")

-- ============================================
-- HÃ€M Há»– TRá»¢
-- ============================================
local function topos(cf)
    pcall(function()
        if LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
            LP.Character.HumanoidRootPart.CFrame = cf
        end
    end)
end

local function getDistance(pos)
    if LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
        return (LP.Character.HumanoidRootPart.Position - pos).Magnitude
    end
    return math.huge
end

-- ============================================
-- ESP CHO CHEST
-- ============================================
function UpdateChestChams()
    for _, v in pairs(WS:GetChildren()) do
        pcall(function()
            if string.find(v.Name, "Chest") and v:IsA("BasePart") then
                if ChestESP then
                    if not v:FindFirstChild('NameEsp'..Number) then
                        local bill = Instance.new('BillboardGui', v)
                        bill.Name = 'NameEsp'..Number
                        bill.Size = UDim2.new(1, 200, 1, 30)
                        bill.AlwaysOnTop = true
                        bill.StudsOffset = Vector3.new(0, 2, 0)
                        
                        local name = Instance.new('TextLabel', bill)
                        name.Size = UDim2.new(1, 0, 1, 0)
                        name.BackgroundTransparency = 1
                        name.TextStrokeTransparency = 0.5
                        name.Font = Enum.Font.GothamBold
                        name.TextSize = 14
                        
                        -- MÃ u theo loáº¡i chest
                        if v.Name == "Chest1" then
                            name.TextColor3 = Color3.fromRGB(109, 109, 109)
                        elseif v.Name == "Chest2" then
                            name.TextColor3 = Color3.fromRGB(173, 158, 21)
                        elseif v.Name == "Chest3" then
                            name.TextColor3 = Color3.fromRGB(85, 255, 255)
                        else
                            name.TextColor3 = Color3.fromRGB(255, 255, 255)
                        end
                        
                        name.Text = v.Name
                    end
                    
                    -- Cáº­p nháº­t khoáº£ng cÃ¡ch
                    local dist = math.floor(getDistance(v.Position)/3)
                    v['NameEsp'..Number].TextLabel.Text = v.Name.." ["..dist.."m]"
                else
                    if v:FindFirstChild('NameEsp'..Number) then 
                        v['NameEsp'..Number]:Destroy() 
                    end
                end
            end
        end)
    end
end

-- ============================================
-- KIá»‚M TRA ITEM QUÃ
-- ============================================
local function hasRareItem()
    local items = {"Fist of Darkness", "God's Chalice"}
    for _, itemName in pairs(items) do
        if LP.Backpack:FindFirstChild(itemName) then return true end
        if LP.Character and LP.Character:FindFirstChild(itemName) then return true end
    end
    return false
end

-- ============================================
-- Dá»ªNG KHI CÃ“ ITEM QUÃ
-- ============================================
task.spawn(function()
    while task.wait(1) do
        if _G.StopChest and hasRareItem() then
            _G.AutoFarmChest = false
            AutoFarmChest = false
            _G.ChestBypass = false
            warn("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
            warn("âš ï¸  TÃŒM THáº¤Y ITEM QUÃ!")
            warn("âš ï¸  ÄÃƒ Dá»ªNG FARM CHEST!")
            warn("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        end
    end
end)

-- ============================================
-- FARM CHEST THÆ¯á»œNG
-- ============================================
task.spawn(function()
    while task.wait() do
        if AutoFarmChest and not _G.ChestBypass then
            pcall(function()
                if not LP.Character or not LP.Character:FindFirstChild("HumanoidRootPart") then return end
                
                local nearestChest = nil
                local nearestDist = math.huge
                
                -- TÃ¬m chest gáº§n nháº¥t
                for _, v in pairs(WS:GetChildren()) do
                    if string.find(v.Name, "Chest") and v:IsA("BasePart") then
                        local dist = getDistance(v.Position)
                        if dist < nearestDist and dist <= 5000 + _G.MagnitudeAdd then
                            nearestChest = v
                            nearestDist = dist
                        end
                    end
                end
                
                -- Farm chest gáº§n nháº¥t
                if nearestChest then
                    repeat task.wait()
                        if WS:FindFirstChild(nearestChest.Name) and AutoFarmChest then
                            topos(nearestChest.CFrame)
                        end
                    until not AutoFarmChest or not nearestChest.Parent or getDistance(nearestChest.Position) > 5000 + _G.MagnitudeAdd
                    
                    _G.MagnitudeAdd = _G.MagnitudeAdd + 1500
                end
            end)
        end
    end
end)

-- ============================================
-- FARM CHEST BYPASS (ÄÃƒ Tá»I Æ¯U)
-- ============================================
task.spawn(function()
    while task.wait(0.5) do
        if _G.ChestBypass then
            pcall(function()
                if not LP.Character or not LP.Character:FindFirstChild("HumanoidRootPart") then return end
                
                local chests = {}
                for _, v in pairs(WS:GetChildren()) do
                    if string.find(v.Name, "Chest") and v:IsA("BasePart") then
                        table.insert(chests, v)
                    end
                end
                
                -- Farm tá»«ng chest
                for _, chest in pairs(chests) do
                    if not _G.ChestBypass then break end
                    
                    -- Teleport
                    topos(chest.CFrame)
                    task.wait(0.1)
                    
                    -- Trigger touch
                    local touch = chest:FindFirstChildOfClass("TouchTransmitter")
                    if touch then
                        firetouchinterest(LP.Character.HumanoidRootPart, chest, 0)
                        task.wait(0.05)
                        firetouchinterest(LP.Character.HumanoidRootPart, chest, 1)
                    end
                    
                    -- Kiá»ƒm tra náº¿u cÃ³ item quÃ½ thÃ¬ dá»«ng
                    if _G.StopChest and hasRareItem() then
                        _G.ChestBypass = false
                        break
                    end
                end
            end)
        end
    end
end)

-- ============================================
-- Tá»° Äá»˜NG CHá»ŒN PHE PIRATES
-- ============================================
task.spawn(function()
    while task.wait(5) do
        if (_G.ChestBypass or AutoFarmChest) then
            pcall(function()
                if not LP.Team or LP.Team.Name ~= "Pirates" then
                    RS.Remotes.CommF_:InvokeServer("SetTeam", "Pirates")
                end
            end)
        end
    end
end)

-- ============================================
-- Cáº¬P NHáº¬T ESP
-- ============================================
task.spawn(function()
    while task.wait(2) do
        if ChestESP then 
            pcall(UpdateChestChams)
        end
    end
end)

-- ============================================
-- THÃ”NG BÃO SCRIPT ÄÃƒ LOAD
-- ============================================
print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
print("ğŸ“¦ CHEST FARM SCRIPT LOADED")
print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
print("")
print("âš¡ Lá»‡nh báº­t farm:")
print("  _G.ChestBypass = true     -- Farm nhanh")
print("  AutoFarmChest = true      -- Farm thÆ°á»ng")
print("")
print("ğŸ” Lá»‡nh khÃ¡c:")
print("  ChestESP = true           -- Báº­t ESP")
print("  _G.StopChest = true       -- Dá»«ng khi cÃ³ item quÃ½")
print("")
print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
